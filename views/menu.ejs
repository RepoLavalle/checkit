<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <h1>Sistema Checklist</h1>
    <h2>Menú:</h2>
    <hr>   
    <pre id='intercambio'><%= contenido %></pre>
    <pre><%= valUsu.carga.nombre %></pre>
    <pre><%= valUsu.carga.apellido %></pre>
    <pre><%= valUsu.carga.nomUsu %></pre>
    <button onclick="volver()">Salir</button>
    <div id="cu10">
        <hr>
        <h2>Nuevo Control</h2>
        <p>
        <label for="parametro">Parámetro:&nbsp;</label>
        <input type="text" name="parametro" id="parametro">
        </p>
        <p>
        <label for="periodicidad">Periodicidad:&nbsp;</label>
        <input type="number" name="periodicidad" id="periodicidad">
        </p>
        <p>
        <label>Prorrogable:</label>
        <input type="radio" id="radio11" name="prorrogable" value="si">
        <label for="radio1">Sí</label>
        <input type="radio" id="radio12" name="prorrogable" value="no">
        <label for="radio2">No</label>
        </p>
        <p>
        <label>Reajustable:</label>
        <input type="radio" id="radio21" name="reajustable" value="si">
        <label for="radio1">Sí</label>
        <input type="radio" id="radio22" name="reajustable" value="no">
        <label for="radio2">No</label>
        </p>
        <p><label>A partir de:&nbsp;</label><input type="date"  id="desde" name="desde"></p>

        <button onclick="cu10_nuevoControl()">Agregar</button>

        <hr>

        <button onclick="cu11_listarControles()">Mis controles</button>
        <div id="cu11_listarControles"></div>

        <script>

            var str_data = document.getElementById('intercambio').innerText;
            console.log(str_data);
            let user = JSON.parse(str_data)
            console.log(user);


            function cu10_nuevoControl(){
                let cu10Nombre = document.getElementById('parametro').value;
                document.getElementById('parametro').value = "";
                //console.log(cu10Nombre);

                let per = document.getElementById('periodicidad').value;
                document.getElementById('periodicidad').value = "";
                //console.log(per)

                pro = document.getElementsByName('prorrogable');
                let prorrogable = false;
                pro[0].checked?prorrogable=true:prorrogable=false;
                document.getElementsByName('prorrogable').checked = false
                //console.log(prorrogable);

                rea = document.getElementsByName('reajustable');
                let reajustable = false;
                rea[0].checked? reajustable=true:null;
                console.log(reajustable);

                document.getElementById('radio11').checked = false
                document.getElementById('radio12').checked = false
                document.getElementById('radio21').checked = false
                document.getElementById('radio22').checked = false

                des = document.getElementById('desde').value;
                document.getElementById('desde').value = ""
                // console.log(des)
                // console.log(JSON.stringify(des))

                let layer0 = {}
                layer0.parametro = cu10Nombre
                layer0.periodicidad = per
                layer0.prorrogable = prorrogable
                layer0.reajustable = reajustable
                layer0.desde = des

                let layer1 = {}
                layer1.cu = "nuevoControl"
                layer1.carga = layer0
                layer1.usuario = user

                fetch('http://localhost:3000/api',{
                    method: 'POST',
                    body: JSON.stringify(layer1),
                    headers: {'Content-Type' : 'application/json'}
                })

            }

            function cu11_listarControles(){
                //alert('running listar controles...')
                let layer0 = {}

                let layer1 = {}
                layer1.cu = "cu11_listarControles"
                layer1.carga = layer0
                layer1.usuario = user

                fetch('http://localhost:3000/api',{
                    method: 'POST',
                    body: JSON.stringify(layer1),
                    headers: {'Content-Type' : 'application/json'}
                })
                .then(data=>data.json())
                .then(data=>listarControles(data[0]))

            }

            function listarControles(data){
                console.log(data);
                for(var i=0 ; i<data.controles.length ; i++){
                    console.log(data.controles[i].parametro +" - "+data.controles[i].periodicidad+
                    " - "+data.controles[i].prorrogable+
                    " - "+data.controles[i].reajustable )
                }
                var str = ""
                for(var i=0 ; i<data.controles.length ; i++){
                    str += "<p><input type='checkbox' name='eliminar'>"+data.controles[i].parametro +" - "+data.controles[i].periodicidad+
                    " - "+data.controles[i].prorrogable+
                    " - "+data.controles[i].reajustable+"</p>"
                }
                document.getElementById('cu11_listarControles').innerHTML = str;
            }
</script>
    </div>
    

    <script>
        function volver(){
            location.href = "http://localhost:3000";
        }
    </script>
</body>
</html>